metadata={systemName:"JSSP-AzureSearchRAG",displayName:"JSSP-AzureSearchRAG",description:"AzureSearchRAG AI  Service Broker",configuration:{}},ondescribe=async function({configuration:e}){postSchema({objects:{Chat:{displayName:"Chat",description:"Chat with OpenAI",properties:{chatinput:{displayName:"chatinput",type:"string"},service_url:{displayName:"Azure OpenAI Service URL",type:"string"},embedding_endpoint:{displayName:"Azure OpenAI Embedding URL",type:"string"},azureai_api_key:{displayName:"AZURE OPENAI KEY",type:"string"},max_tokens:{displayName:"Max Tokens",type:"string"},search_endpoint:{displayName:"Azure Search EndPoint",type:"string"},search_key:{displayName:"Azure Search Key",type:"string"},search_index:{displayName:"Azure Search Index",type:"string"},search_semantic_coniguration:{displayName:"Azure Search Semantic Configuration",type:"string"},chatoutput:{displayName:"chatoutput",type:"string"},citation1:{displayName:"Citation 1",type:"string"},citation1_content:{displayName:"Citation 1 Content",type:"string"},citation2:{displayName:"Citation 2",type:"string"},citation2_content:{displayName:"Citation 2 Content",type:"string"},citation3:{displayName:"Citation 3",type:"string"},citation3_content:{displayName:"Citation 3 Content",type:"string"}},methods:{getResponse:{displayName:"Get Response",type:"read",inputs:["chatinput","service_url","embedding_endpoint","azureai_api_key","max_tokens","search_endpoint","search_key","search_index","search_semantic_coniguration"],outputs:["chatoutput","citation1","citation1_content","citation2","citation2_content","citation3","citation3_content"]}}},Blob:{displayName:"Blob",description:"Blob Information",properties:{blob_function_website:{displayName:"Website hosting functions",type:"string"},blob_function_name:{displayName:"Name of the function to call",type:"string"},blob_function_key:{displayName:"Key to access blob function",type:"string"},storage_account_name:{displayName:"storage account for blobs",type:"string"},storage_container_name:{displayName:"Blob Container Name",type:"string"},blob_name:{displayName:"name of the blob",type:"string"},blob_url:{displayName:"Encoded URL for the blob",type:"string"},storage_account_key:{displayName:"storage account key",type:"string"},blob_sas_url:{displayName:"URL to access or download blob",type:"string"}},methods:{getBlobList:{displayName:"Get Blob List",type:"list",inputs:["blob_function_website","blob_function_name","blob_function_key","storage_account_name","storage_container_name","storage_account_key"],outputs:["blob_name, blob_url"]},getBlobURL:{displayName:"Get Blob List",type:"read",inputs:["blob_function_website","blob_function_name","blob_function_key","storage_account_name","storage_container_name","storage_account_key","blob_name"],outputs:["blob_url"]}}}}})},onexecute=async function({objectName:e,methodName:t,parameters:n,properties:a,configuration:o}){switch(e){case"Chat":await async function(e,t,n,a){switch(e){case"getResponse":await function(e,t,n){return new Promise(((e,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){try{if(4!==a.readyState)return;if(200!==a.status)throw new Error("Failed with status "+a.status);var t=JSON.parse(a.responseText);const n=t.choices[0].message.context.citations,o=n[0],i=n[1],s=n[2];postResult({chatoutput:t.choices[0]?t.choices[0].message.content:"No response",citation1:o.title,citation1_content:o.content,citation2:i.title,citation2_content:i.content,citation3:s.title,citation3_content:s.content}),e()}catch(e){n(e)}};var o={messages:[{role:"system",content:"You are an AI assistant that helps people find information. Only use the information included"},{role:"user",content:t.chatinput+""}],temperature:.7,top_p:.95,frequency_penalty:0,presence_penalty:0,max_tokens:800,stop:null,data_sources:[{type:"azure_search",parameters:{filter:null,endpoint:t.search_endpoint+"",index_name:t.search_index+"",semantic_configuration:t.search_semantic_coniguration+"",authentication:{type:"api_key",key:t.search_key+""},embedding_dependency:{type:"endpoint",endpoint:t.embedding_endpoint+"",authentication:{type:"api_key",key:t.azureai_api_key+""}},query_type:"vector_simple_hybrid",in_scope:!0,strictness:3,top_n_documents:5}}]};a.open("POST",t.service_url+""),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("api-key",t.azureai_api_key),a.send(JSON.stringify(o))}))}(0,n);break;default:throw new Error("The method "+e+" is not supported.")}}(t,0,a);break;case"Blob":await async function(e,t,n,a){switch(e){case"getBlobList":await function(e,t,n){return new Promise(((e,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){try{if(4!==a.readyState)return;if(200!==a.status)throw new Error("Failed with status "+a.status);var t=JSON.parse(a.responseText);postResult(t.map((e=>({blob_name:e.name,blob_url:e.url})))),e()}catch(e){n(e)}};var o=t.blob_function_website+"api/"+t.blob_function_name+"?storageaccount="+t.storage_account_name+"&containername="+t.storage_container_name+"&accountkey="+encodeURIComponent(t.storage_account_key+"")+"&code="+t.blob_function_key;console.log(o),a.open("GET",o),a.send()}))}(0,n);break;case"getBlobURL":await function(e,t,n){return new Promise(((e,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){try{if(4!==a.readyState)return;if(200!==a.status)throw new Error("Failed with status "+a.status);console.log(a.responseText),postResult({blob_url:a.responseText}),e()}catch(e){n(e)}};var o=t.blob_function_website+"api/"+t.blob_function_name+"?storageaccount="+t.storage_account_name+"&blobname="+t.blob_name+"&containername="+t.storage_container_name+"&accountkey="+encodeURIComponent(t.storage_account_key+"")+"&code="+t.blob_function_key;console.log(o),a.open("GET",o),a.send()}))}(0,n);break;default:throw new Error("The method "+e+" is not supported.")}}(t,0,a);break;default:throw new Error("The object "+e+" is not supported.")}};
//# sourceMappingURL=jssp-azuresearchrag.js.map
