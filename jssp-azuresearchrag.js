metadata={systemName:"JSSP-AzureSearchRAG",displayName:"JSSP-AzureSearchRAG",description:"AzureSearchRAG AI  Service Broker",configuration:{}},ondescribe=async function({configuration:t}){postSchema({objects:{Chat:{displayName:"Chat",description:"Chat with OpenAI",properties:{chathistory:{displayName:"chathistory",type:"string"},chatinput:{displayName:"chatinput",type:"string"},service_url:{displayName:"Azure OpenAI Service URL",type:"string"},embedding_endpoint:{displayName:"Azure OpenAI Embedding URL",type:"string"},azureai_api_key:{displayName:"AZURE OPENAI KEY",type:"string"},max_tokens:{displayName:"Max Tokens",type:"string"},search_endpoint:{displayName:"Azure Search EndPoint",type:"string"},search_key:{displayName:"Azure Search Key",type:"string"},search_index:{displayName:"Azure Search Index",type:"string"},search_semantic_coniguration:{displayName:"Azure Search Semantic Configuration",type:"string"},chatoutput:{displayName:"chatoutput",type:"string"},outputjson:{displayName:"outputjson",type:"string"},citation1:{displayName:"Citation 1",type:"string"},citation1_content:{displayName:"Citation 1 Content",type:"string"},citation2:{displayName:"Citation 2",type:"string"},citation2_content:{displayName:"Citation 2 Content",type:"string"},citation3:{displayName:"Citation 3",type:"string"},citation3_content:{displayName:"Citation 3 Content",type:"string"}},methods:{getResponse:{displayName:"Get Response",type:"read",inputs:["chathistory","chatinput","service_url","embedding_endpoint","azureai_api_key","max_tokens","search_endpoint","search_key","search_index","search_semantic_coniguration"],outputs:["chathistory","chatoutput","outputjson","citation1","citation1_content","citation2","citation2_content","citation3","citation3_content"]}}},Blob:{displayName:"Blob",description:"Blob Information",properties:{blob_function_website:{displayName:"Website hosting functions",type:"string"},blob_function_name:{displayName:"Name of the function to call",type:"string"},blob_function_key:{displayName:"Key to access blob function",type:"string"},storage_account_name:{displayName:"storage account for blobs",type:"string"},storage_container_name:{displayName:"Blob Container Name",type:"string"},blob_name:{displayName:"name of the blob",type:"string"},blob_url:{displayName:"Encoded URL for the blob",type:"string"},storage_account_key:{displayName:"storage account key",type:"string"},blob_sas_url:{displayName:"URL to access or download blob",type:"string"}},methods:{getBlobList:{displayName:"Get Blob List",type:"list",inputs:["blob_function_website","blob_function_name","blob_function_key","storage_account_name","storage_container_name","storage_account_key"],outputs:["blob_name, blob_url"]},getBlobURL:{displayName:"Get Blob URL",type:"read",inputs:["blob_function_website","blob_function_name","blob_function_key","storage_account_name","storage_container_name","storage_account_key","blob_name"],outputs:["blob_url"]}}}}})},onexecute=async function({objectName:t,methodName:e,parameters:n,properties:a,configuration:o}){switch(t){case"Chat":await async function(t,e,n,a){switch(t){case"getResponse":await function(t,e,n){return new Promise(((t,n)=>{var a=[];(a=e.chathistory?JSON.parse(e.chathistory+""):[{role:"system",content:"You are an AI assistant that helps people find information. Only use the information included."}]).push({role:"user",content:e.chatinput+""});var o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4!==o.readyState)return;if(200!==o.status)throw new Error("Failed with status "+o.status);var e=JSON.parse(o.responseText);const n=e.choices[0].message.context.citations,i=n[0],s=n[1],r=n[2];postResult({chatoutput:e.choices[0]?e.choices[0].message.content:"No response",chathistory:JSON.stringify(a),citation1:i.title,citation1_content:i.content,citation2:s.title,citation2_content:s.content,citation3:r.title,citation3_content:r.content,outputjson:o.responseText}),t()}catch(t){n(t)}};var i={messages:a,temperature:.7,top_p:.95,frequency_penalty:0,presence_penalty:0,max_tokens:800,stop:null,data_sources:[{type:"azure_search",parameters:{filter:null,endpoint:e.search_endpoint+"",index_name:e.search_index+"",semantic_configuration:e.search_semantic_coniguration+"",authentication:{type:"api_key",key:e.search_key+""},embedding_dependency:{type:"endpoint",endpoint:e.embedding_endpoint+"",authentication:{type:"api_key",key:e.azureai_api_key+""}},query_type:"vector_simple_hybrid",in_scope:!0,strictness:3,top_n_documents:5}}]};o.open("POST",e.service_url+""),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("api-key",e.azureai_api_key+""),o.send(JSON.stringify(i))}))}(0,n);break;default:throw new Error("The method "+t+" is not supported.")}}(e,0,a);break;case"Blob":await async function(t,e,n,a){switch(t){case"getBlobList":await function(t,e,n){return new Promise(((t,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){try{if(4!==a.readyState)return;if(200!==a.status)throw new Error("Failed with status "+a.status);var e=JSON.parse(a.responseText);postResult(e.map((t=>({blob_name:t.name,blob_url:t.url})))),t()}catch(t){n(t)}};var o=e.blob_function_website+"api/"+e.blob_function_name+"?storageaccount="+e.storage_account_name+"&containername="+e.storage_container_name+"&accountkey="+encodeURIComponent(e.storage_account_key+"")+"&code="+e.blob_function_key;console.log(o),a.open("GET",o),a.send()}))}(0,n);break;case"getBlobURL":await function(t,e,n){return new Promise(((t,n)=>{var a=new XMLHttpRequest;a.onreadystatechange=function(){try{if(4!==a.readyState)return;if(200!==a.status)throw new Error("Failed with status "+a.status);console.log(a.responseText),postResult({blob_url:a.responseText}),t()}catch(t){n(t)}};var o=e.blob_function_website+"api/"+e.blob_function_name+"?storageaccount="+e.storage_account_name+"&blobname="+e.blob_name+"&containername="+e.storage_container_name+"&accountkey="+encodeURIComponent(e.storage_account_key+"")+"&code="+e.blob_function_key;console.log(o),a.open("GET",o),a.send()}))}(0,n);break;default:throw new Error("The method "+t+" is not supported.")}}(e,0,a);break;default:throw new Error("The object "+t+" is not supported.")}};
//# sourceMappingURL=jssp-azuresearchrag.js.map
